@page "/contact"

<h2 style="font-size: 35px;">Contact the Developer</h2>
<p style="padding-top: 5px; padding-bottom: 20px;">Use this form to send an email to the developer. It can take awhile to submit so please be patient</p>

<form id="contactForm" action="https://formsubmit.co/ce20394ce2b36adcd2e3edf9c0ddf9ab" method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <label class="contact-label" for="email">Email:</label>
        <input type="email" id="email" name="email" required="">
        <label class="contact-label" style="padding-left: 20px;" for="attachment">Attach an Image (optional):</label>
        <input type="file" id="attachment" name="attachment" accept="image/*">
    </div>
    <div class="form-group">
        <label class="contact-label" for="message">Message:</label>
        <textarea id="message" name="message" required=""></textarea>
    </div>
    <input type="text" name="_honey" style="display:none">
    <input type="hidden" name="_captcha" value="false">
    <button class="btn-primary generate-title" type="submit">Send</button>
    <p id="success-message" style="display: none; padding-top: 5px; padding-left: 150px; font-size: 14px; position: absolute; color: green;">Thank you for your message! The developer will get back to you soon.</p>
    <p id="error-message" style="display:none; padding-top: 5px; padding-left: 150px; font-size: 14px; position: absolute; color: red;">There was an issue with your submission. Please try again later.</p>
    <button type="reset" class="btn-primary reset-button">Reset</button>
</form>

<div id="loading-spinner" style="display:none;">
    <span style="font-size: 13px; color: #4d3c07;">Please wait...Sending...</span>
    <div class="spinner"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('contactForm');
        const spinner = document.getElementById('loading-spinner');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const submitButton = form.querySelector('button[type="submit"]');

        // Modify form action to prevent redirect
        const originalAction = form.getAttribute('action');

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission

            // Ensure spinner is visible and positioned correctly
            spinner.style.display = 'block';
            console.log('Spinner set to visible');


            // Reset previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            // Disable submit button
            submitButton.disabled = true;

            try {
                // Create FormData to submit
                const formData = new FormData(form);

                // Use fetch to submit form data
                const response = await fetch(originalAction, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors' // Prevents CORS errors with FormSubmit
                });

                // Simulate success (FormSubmit doesn't return a typical response)
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Show success message
                successMessage.style.display = 'block';
                form.reset();
            } catch (error) {
                // Show error message
                console.error('Submission error:', error);
                errorMessage.style.display = 'block';
            } finally {
                // Hide spinner
                spinner.style.display = 'none';

                // Re-enable submit button
                submitButton.disabled = false;
            }
        });
    });
</script>
